### Описание логики управления устройствами и телеметрией

#### 1. **Создание устройства**
- **Метод:** `registerDevice`
- **Описание:** Этот метод отвечает за регистрацию нового устройства в системе. После успешной регистрации устройство сохраняется в базе данных и возвращается в ответе.

#### 2. **Обновление состояния устройства**
- **Метод:** `updateDeviceStatus`
- **Описание:** Этот метод позволяет обновить состояние существующего устройства. Новое состояние устройства передается в запросе и сохраняется в базе данных. После успешного обновления новое состояние возвращается в ответе.

#### 3. **Отправка команды устройству**
- **Метод:** `sendCommand`
- **Описание:** Этот метод используется для отправки команды устройству через Kafka. Команда сериализуется в JSON и отправляется в Kafka с использованием `KafkaTemplate`.
    - **Дополнительно:** Используется `CompletableFuture` для асинхронной обработки результата отправки. Метод проверяет успешность отправки и обрабатывает возможные ошибки.

### Логика взаимодействия между микросервисами управления устройствами и телеметрией

#### **Микросервис "Управление устройствами"**
- **Метод:** `registerDevice`
- **Описание:** Регистрирует новое устройство.
- **Метод:** `updateDeviceStatus`
- **Описание:** Обновляет состояние устройства.
- **Метод:** `sendCommand`
- **Описание:** Отправляет команды устройству через Kafka.

#### **Микросервис "Управление телеметрией"**
- **Метод:** `receiveTelemetry`
- **Описание:** Принимает и сохраняет данные телеметрии от устройств.
- **Метод:** `getTelemetryByDeviceId`
- **Описание:** Возвращает данные телеметрии для указанного устройства.

### Асинхронное взаимодействие с использованием Kafka

- **Методы:** `sendCommand` и `processCommand`
- **Описание:** Эти методы позволяют микросервису "Управление устройствами" отправлять команды устройствам, используя Kafka. Ответы обрабатываются асинхронно с помощью `CompletableFuture`.

### Интеграция с монолитом с использованием Kafka
Обмен с монолитом можно реализовать с помощью producer и использовать для публикаций kafkaTemplate.send или KafkaListener

## доп
Реализация саги - при создании нового устройства может возникнуть ошибка в сервисе Управление телеметрией,
что в свою очередь должна отменить создание в основном сервисе Управление устройствами, ниже показан код отправки такого воздействия путем записи в топик 
rollback команды на откат. Со стороны сервиса Управление устройствами идет обработка этого топика и при получении определенных эвентов устройство будет удалено
```
@KafkaListener(topics = "device-topic", groupId = "telemetry-group")
public void handleNewDevice(String message) {
var device = convert.JsonToDevice(message);// Обработка нового устройства (например, подготовка для приема телеметрии)

        try {
            log.info("New device registered: {}", message);

        } catch (Exception e) {
            //saga rollback
            log.error("ошибка обработки нового устройства {}", e.getMessage());
            RollbackDto rollbackDto = new RollbackDto();
            rollbackDto.setIdDevice(device.getDeviceId());
            rollbackDto.setDescription(e.getMessage());
            rollbackDto.setTypeEvent("device");
            var mes = convert.getJsonDevice(rollbackDto);
            kafkaTemplate.send("rollback-topic", mes);
        }


    }
```